<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>ADMIN PAGE</title>
    <link href="/css/dist/tabler.min.css?1692870487" rel="stylesheet"/>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
<div class="container">
    <!-- 헤더 -->
    <div th:replace="~{fragments/header :: header}" class="col-3"></div>

    <div class="page-header d-print-none">
        <div class="container-xl">
            <div class="row g-2 align-items-center">
                <div class="col-9">
                    <h1 class="page-title">ADMIN PAGE</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid d-flex gap-4 p-4 align-items-start">
        <!-- 사이드 메뉴 -->
        <div th:replace="~{fragments/admin :: admin}"></div>
        <div class="page-wrapper">
            <div class="page-body">
                <div class="container-xl">
                    <div class="row row-deck row-cards">
                        <!-- 기존 UI 유지 -->
                        <div class="col-md-12 col-lg-10">
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="card-title">카테고리별 판매된 도서 수</h3>
                                    <div id="chart-mentions" class="chart-lg"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12 col-lg-10">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Most View Books</h3>
                                </div>
                                <div class="card-table table-responsive">
                                    <table class="table admin-page-table">
                                        <thead>
                                        <tr>
                                            <th>BOOK NAME</th>
                                            <th>AUTHOR(S)</th>
                                            <th>LIKES</th>
                                            <th>BOOK VIEW</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="book : ${mostVisitedBooks}">
                                            <td th:text="${book.bookTitle}"></td>
                                            <td>
                                                <ul>
                                                    <li th:each="author : ${bookAuthorsMap[book.bookId]}" th:text="${author.authorName}"></li>
                                                </ul>
                                            </td>
                                            <td th:text="${bookLikesMap[book.bookId]}"></td>
                                            <td th:text="${book.bookView}"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- 주문 상태 관리 -->
                        <div class="col-md-12 col-lg-10">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h3 class="card-title">배송 상태 관리</h3>
                                </div>
                                <div class="table-responsive">
                                    <table class="table admin-page-table">
                                        <thead>
                                        <tr>
                                            <th>주문 ID</th>
                                            <th>회원 ID</th>
                                            <th>회원 이름</th>
                                            <th>도서 ID</th>
                                            <th>도서 이름</th>
                                            <th>총 가격</th>
                                            <th>상태</th>
                                            <th>주문 일자</th>
                                            <th>우편번호</th>
                                            <th>주소</th>
                                            <th>포장 여부</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="order : ${orders}">
                                            <td>
                                                <a th:href="@{/admin/orders/{orderId}(orderId=${order.orderId})}" th:text="${order.orderId}"></a>-
                                            </td>
                                            <td th:text="${order.member != null ? order.member.memberId : 'Unknown'}">-</td>
                                            <td th:text="${order.member != null and order.member.memberName != null ? order.member.memberName : 'Unknown'}">-</td>
                                            <td>
                                                <ul>
                                                    <li th:each="book : ${order.books}" th:text="${book.bookId}"></li>
                                                </ul>
                                            </td>
                                            <td>
                                                <ul>
                                                    <li th:each="book : ${order.books}" th:text="${book != null && book.bookName != null ? book.bookName : 'Unknown'}"></li>
                                                </ul>
                                            </td>
                                            <td th:text="${order.orderPrice}">-</td>
                                            <td th:text="${order.orderStatus.orderStatus}">-</td>
                                            <td th:text="${#temporals.format(order.orderedAt, 'yyyy-MM-dd HH:mm')}">-</td>
                                            <td th:text="${order.zoneCode}">-</td>
                                            <td th:text="${order.address} + ' ' + ${order.addressDetail}">-</td>
                                            <td th:text="${order.wrappingPaper != null ? '포함' : '없음'}">-</td>
                                        </tr>
                                        <tr th:if="${orders == null or #lists.isEmpty(orders)}">
                                            <td colspan="9" class="text-center">No orders available</td>
                                        </tr>
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>
                        <!-- 페이징 -->
                        <div class="mt-4">
                            <nav aria-label="Page navigation example" class="mt-4">
                                <ul class="pagination justify-content-center">
                                    <!-- 이전 버튼 -->
                                    <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                                        <a class="page-link"
                                           th:href="'https://www.hexabook.shop/admin?page=' + (${currentPage > 1 ? currentPage - 1 : 1})">
                                            &laquo;
                                        </a>
                                    </li>

                                    <!-- 페이지 번호 -->
                                    <li class="page-item" th:each="i : ${totalPages > 0 ? #numbers.sequence(1, totalPages) : #numbers.sequence(1, 1)}"
                                        th:classappend="${i == currentPage} ? 'active'">
                                        <a class="page-link" th:text="${i}"
                                           th:href="'https://www.hexabook.shop/admin?page=' + ${i}"></a>
                                    </li>

                                    <!-- 다음 버튼 -->
                                    <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                                        <a class="page-link"
                                           th:href="'https://www.hexabook.shop/admin?page=' + (${currentPage < totalPages ? currentPage + 1 : totalPages})">
                                            &raquo;
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}" class="footer mt-auto"></div>
</div>
</body>
</html>


<!-- Libs JS -->
<script src="/css/dist/apexcharts.min.js?1692870487" defer></script>
<script src="/css/dist/jsvectormap.min.js?1692870487" defer></script>
<script src="/css/dist/world.js?1692870487" defer></script>
<script src="/css/dist/world-merc.js?1692870487" defer></script>
<!-- Tabler Core -->
<script src="/css/dist/tabler.min.js?1692870487" defer></script>
<script src="/css/dist/demo.min.js?1692870487" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        window.ApexCharts && (new ApexCharts(document.getElementById('chart-mentions'), {
            chart: {
                type: "bar",
                fontFamily: 'inherit',
                height: 240,
                parentHeightOffset: 0,
                toolbar: {
                    show: false,
                },
                animations: {
                    enabled: false
                },
                stacked: true,
            },
            plotOptions: {
                bar: {
                    columnWidth: '50%',
                }
            },
            dataLabels: {
                enabled: false,
            },
            fill: {
                opacity: 1,
            },
            series: [{
                name: "Web",
                data: [1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 2, 12, 5, 8, 22, 6, 8, 6, 4, 1, 8, 24, 29, 51, 40, 47, 23, 26, 50, 26, 41, 22, 46, 47, 81, 46, 6]
            },{
                name: "Social",
                data: [2, 5, 4, 3, 3, 1, 4, 7, 5, 1, 2, 5, 3, 2, 6, 7, 7, 1, 5, 5, 2, 12, 4, 6, 18, 3, 5, 2, 13, 15, 20, 47, 18, 15, 11, 10, 0]
            },{
                name: "Other",
                data: [2, 9, 1, 7, 8, 3, 6, 5, 5, 4, 6, 4, 1, 9, 3, 6, 7, 5, 2, 8, 4, 9, 1, 2, 6, 7, 5, 1, 8, 3, 2, 3, 4, 9, 7, 1, 6]
            }],
            tooltip: {
                theme: 'dark'
            },
            grid: {
                padding: {
                    top: -20,
                    right: 0,
                    left: -4,
                    bottom: -4
                },
                strokeDashArray: 4,
                xaxis: {
                    lines: {
                        show: true
                    }
                },
            },
            xaxis: {
                labels: {
                    padding: 0,
                },
                tooltip: {
                    enabled: false
                },
                axisBorder: {
                    show: false,
                },
                type: 'datetime',
            },
            yaxis: {
                labels: {
                    padding: 4
                },
            },
            labels: [
                '2020-06-20', '2020-06-21', '2020-06-22', '2020-06-23', '2020-06-24', '2020-06-25', '2020-06-26', '2020-06-27', '2020-06-28', '2020-06-29', '2020-06-30', '2020-07-01', '2020-07-02', '2020-07-03', '2020-07-04', '2020-07-05', '2020-07-06', '2020-07-07', '2020-07-08', '2020-07-09', '2020-07-10', '2020-07-11', '2020-07-12', '2020-07-13', '2020-07-14', '2020-07-15', '2020-07-16', '2020-07-17', '2020-07-18', '2020-07-19'
            ],
            colors: [tabler.getColor("primary")],
            legend: {
                show: false,
            },
            point: {
                show: false
            },
        })).render();
    });
</script>
